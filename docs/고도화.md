# figmaV3 ì½”ë“œë² ì´ìŠ¤ ë¶„ì„ & ê³ ë„í™” ì œì•ˆ (2025-08-28)

> ê¸°ì¤€: ì²¨ë¶€ zip(`/src/figmaV3`) ì†ŒìŠ¤ ì „ìˆ˜ ìŠ¤ìº” ê²°ê³¼. any ê¸ˆì§€/React ìµœìƒìœ„ í›… ê·œì¹™/ì–•ì€ ë³µì‚¬ ì—…ë°ì´íŠ¸ ê·œì•½ì„ ì¤€ìˆ˜í•˜ëŠ”ì§€ í•¨ê»˜ ì ê²€í–ˆìŠµë‹ˆë‹¤.

---

## 0) ë””ë ‰í„°ë¦¬ ê°œìš”

```
src/figmaV3
â”œâ”€ core/                # SSOT íƒ€ì… ì •ì˜ + Registry(ì •ì˜/ë Œë”ëŸ¬)
â”œâ”€ editor/              # ì—ë””í„° UI (ì¢Œ/ì¤‘ì•™/ìš° + í•˜ë‹¨ ë„í¬)
â”‚  â”œâ”€ components/       # ê¸°ë³¸ ì»´í¬ë„ŒíŠ¸ 4ì¢…(Box/Button/Text/Image) + ë“±ë¡ íŒŒì¼
â”‚  â”œâ”€ leftPanel/        # Explorer / Composer(Templates+Palette) / Layers
â”‚  â”œâ”€ centerPanel/      # Canvas(Shadow DOM), OverlayHost(Fragments)
â”‚  â”œâ”€ rightPanel/       # Inspector(Common/PropsAuto/Styles, SchemaEditor)
â”‚  â”œâ”€ bottomPanel/      # Actions / Flows / Data / Fragments + ê³ ê¸‰ íŒ¨ë„ í˜¸ìŠ¤íŠ¸
â”‚  â”œâ”€ common/           # WhenBuilder ë“± ê³µìš© UI
â”‚  â”œâ”€ ui/               # theme.module.css (ì—ë””í„° í† í°)
â”‚  â””â”€ useEditor.ts      # Zustand êµ¬ë… í›…(useSyncExternalStore)
â”œâ”€ runtime/             # ì•ˆì „ í‘œí˜„ì‹/DOM ë³€í™˜/ìŠ¤íƒ€ì¼ ìœ í‹¸/ì•¡ì…˜/í”Œë¡œìš°/ì˜ì†í™”
â””â”€ store/               # Zustand(ì—ë””í„° ìƒíƒœ+ì•¡ì…˜)
```

---

## 1) í•µì‹¬ ì•„í‚¤í…ì²˜ ì •ë¦¬

### 1.1 íƒ€ì… SSOT â€” `core/types.ts`

* **Node / Project / EditorState / EditorUI**: ì—ë””í„° ìƒíƒœ ì „ë°˜ ì •ì˜ (ì„ íƒ ë…¸ë“œ, ì¢Œìš°í­, í•˜ë‹¨ íŒ¨ë„ í¬ê¸°, ì¢Œì¸¡ ë¶„í•  ë¹„ìœ¨, ëª¨ë“œ, ì „ë¬¸ê°€ ëª¨ë“œ, overlay ìŠ¤íƒ ë“±).
* **ComponentDefinition**: `defaults`(props/styles), `propsSchema(text/select)`, `capabilities`(í—ˆìš© íƒœê·¸Â·ìŠ¤íƒ€ì¼Â·ì´ë²¤íŠ¸/í”Œë¡œìš° ì¢…ë¥˜Â·ë°”ì¸ë”© í‚¤), `templates`ë¥¼ ìœ„í•œ ì˜¤ë²„ë¼ì´ë“œ ì§€ì  ì œê³µ.
* **Action/Flow**: `SupportedEvent('onClick'|'onChange'|'onSubmit'|'onLoad')`, `ActionStep(Alert/SetData/SetProps/Http/Emit/Navigate/OpenFragment/CloseFragment)`, `FlowEdge(fromâ†’to + when.expr)`.
* **TagPolicy / TagPolicyMap**: íƒœê·¸ë³„ í—ˆìš© attribute/ìŠ¤íƒ€ì¼/void ì—¬ë¶€ ì •ì±….
* **Dnd íƒ€ì… ìŠ¤í…**: paletteâ†’canvas, canvas ë‚´ë¶€ ì •ë ¬ì„ ìœ„í•œ íƒ€ì…ë§Œ ì •ì˜(êµ¬í˜„ì€ ë¯¸í¬í•¨).

### 1.2 ë ˆì§€ìŠ¤íŠ¸ë¦¬ â€” `core/registry.ts`

* **ë“±ë¡/ì¡°íšŒ**: `register(def, renderer)`, `getDefinition(id)`, `getRenderer(id)`, `listDefinitions()`.
* **ë Œë”ëŸ¬ ê·œì•½**: â€œí˜¸ìŠ¤íŠ¸ ìš”ì†Œë§Œâ€ ë°˜í™˜. Canvasê°€ ìŠ¤íƒ€ì¼/ì„ íƒ/ìì‹ ì£¼ì…ì„ ë‹´ë‹¹.

### 1.3 ìŠ¤í† ì–´ â€” `store/editStore.ts`

* Zustand/vanilla ê¸°ë°˜. **ì–•ì€ ë³µì‚¬ update** ê·œì•½ìœ¼ë¡œ ì¼ê´€ì„± ìœ ì§€.
* ì•¡ì…˜ í•µì‹¬:

    * ë…¸ë“œ ì¶”ê°€/ì‚­ì œ/íŒ¨ì¹˜/props ë³‘í•©/ìŠ¤íƒ€ì¼ ë³‘í•©
    * **í˜ì´ì§€** ì¶”ê°€/ì‚­ì œ/ì„ íƒ(rootId ìŠ¤ìœ„ì¹­)
    * **í”„ë˜ê·¸ë¨¼íŠ¸** ì¶”ê°€/ì‚­ì œ + **ì˜¤ë²„ë ˆì´ open/close ìŠ¤íƒ**
    * **FlowEdge** CRUD
    * ì „ì—­ `data`/`settings` ì„¸íŒ…
    * **hydrateDefaults(defId)**: ë ˆì§€ìŠ¤íŠ¸ë¦¬ defaultsë¥¼ ë…¸ë“œì— ë°˜ì˜

### 1.4 ëŸ°íƒ€ì„ ìœ í‹¸ â€” `runtime/*`

* `expr.ts`: when ì•ˆì „ íŒŒì„œ/í‰ê°€ê¸°(ë…¼ë¦¬/ë¹„êµ/ê´„í˜¸/ë¦¬í„°ëŸ´). í•¨ìˆ˜í˜¸ì¶œÂ·\[] ì¸ë±ì‹±ì€ ì•ˆì „ìƒ ë¯¸ì§€ì›.
* `binding.ts`: `{{ data.xxx }}` ë¨¸ìŠ¤íƒœì‹œ ì¹˜í™˜ + ì•ˆì „ ê²½ë¡œ ì ‘ê·¼.
* `domAttrs.ts`: React DOM ì†ì„± ë³€í™˜(classâ†’className, forâ†’htmlFor) + ì •ì±… ê¸°ë°˜ í•„í„° + className ë³‘í•©.
* `capabilities.ts`/`tagPolicyUtils.ts`: íƒœê·¸/ìŠ¤íƒ€ì¼ í—ˆìš© íŒì •, applied tag ê³„ì‚°(`__tag` â†’ defaultTag â†’ 'div').
* `styleUtils.ts`: kebabâ†’camel, ìˆ«ìí˜• í‚¤ ì •ê·œí™”, ì–•ì€ ë³‘í•© ìœ í‹¸.
* `actions.ts`/`flow.ts`: `runActions(steps,deps)` + from(event) ë§¤ì¹­/when í‰ê°€/ì ìš©.
* `persistence.ts`: **localStorage** ì €ì¥/ë³µì› + API ìŠ¤í…(`loadProject`/`saveProject`).

---

## 2) ì—ë””í„° UI ì œê³µ ê¸°ëŠ¥ (í˜„ ë²„ì „)

### 2.1 ìƒë‹¨ë°” â€” `topbar/PageBar.tsx`

* **í˜„ì¬ í˜ì´ì§€ í‘œì‹œ/ì „í™˜**
* **ëª¨ë“œ**: Page / Component (í† ê¸€)
* **Expert ëª¨ë“œ**: í…œí”Œë¦¿ í•„í„° ë¬´ì‹œ(ë‹¨, TagPolicyëŠ” í•­ìƒ ì ìš©)

### 2.2 ì¢Œì¸¡ ì‚¬ì´ë“œë°” â€” `leftPanel/LeftSidebar.tsx`

* **íƒ­**: Explorer / Composer, ìƒÂ·í•˜ **ë¦¬ì‚¬ì´ì €**ë¡œ ë¶„í• (ë¹„ìœ¨ `ui.leftSplitPct` ì €ì¥)
* **Explorer.Top/Bottom** â€” `ExplorerPane.tsx`

    * Top: Page/Component ëª©ë¡, ì„ íƒ ì‹œ í•˜ë‹¨ í”„ë¦¬ë·° íƒ€ê²Ÿ ë°˜ì˜
    * Bottom: ì„ íƒ ëŒ€ìƒ ìš”ì•½ + **Page Create/Open/Duplicate/Delete**, **Name/Slug í¸ì§‘** UX
    * **ProjectStylesheets** ê´€ë¦¬(Inline/URL, enable í† ê¸€)
* **Composer.Top** â€” `TemplatesPanel.tsx` + `Palette.tsx`

    * **Templates**: í”„ë¡œì íŠ¸ í…œí”Œë¦¿ ìƒì„±(ì„ íƒ ë…¸ë“œ ìº¡ì²˜ ì˜µì…˜), ê²€ìƒ‰/ì‚½ì…
    * **Palette**: ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì»´í¬ë„ŒíŠ¸ ê²€ìƒ‰/ì‚½ì…
* **Composer.Bottom** â€” `Layers.tsx`

    * ë‹¨ìˆœ íŠ¸ë¦¬(ì„ íƒ/ì‚­ì œ, ë£¨íŠ¸ ì‚­ì œ ê¸ˆì§€)

### 2.3 ì¤‘ì•™ â€” `centerPanel/Canvas.tsx`

* **Shadow DOM** ê²©ë¦¬(ì‚¬ìš©ì CSS ì£¼ì…: URL/inline)
* **ì„ íƒ í•˜ì´ë¼ì´íŠ¸**(outline), **Boxë§Œ ì»¨í…Œì´ë„ˆ**ë¡œ ìì‹ ì£¼ì…. void/ë¹„ì»¨í…Œì´ë„ˆëŠ” í˜•ì œ ë Œë”.
* **ì´ë²¤íŠ¸ íŒŒì´í”„ë¼ì¸**: ë Œë”ëŸ¬ì˜ onClickê³¼ ì—ë””í„° onSelectë¥¼ `chainClick`ìœ¼ë¡œ ì•ˆì „ ê²°í•© â†’
  ì„ íƒ/ì•¡ì…˜ ë™ì‹œ ë™ì‘. `runActions` í˜¸ì¶œì€ Canvasì—ì„œ ë‹´ë‹¹.

### 2.4 ìš°ì¸¡ â€” `rightPanel/Inspector.tsx`

* **CommonSection**: id/name/slot/tag ì „í™˜ + **Tag Attributes ë™ì  í¸ì§‘**(class í† í° í•©ì¹˜ê¸°, inline CSS ìŠ¤ìº”ìœ¼ë¡œ í´ë˜ìŠ¤ ì¶”ì²œ)
* **PropsAutoSection**: `propsSchema(text/select)` ê¸°ë°˜ ìë™ UI â†’ `updateNodeProps`ë¡œ ì €ì¥
* **StylesSection**: ê·¸ë£¹(ìˆœì„œ ê³ ì •)

    1. Layout 2) Typography 3) Position 4) Spacing 5) Border 6) Background 7) Effects 8) Custom

    * **TagPolicy + í…œí”Œë¦¿ í•„í„°** ë°˜ì˜, **Expert ëª¨ë“œ** ì‹œ í…œí”Œë¦¿ í•„í„° ë¬´ì‹œ

### 2.5 í•˜ë‹¨ ë„í¬ â€” `bottomPanel/*`

* **Tabs**: Actions / Flows / Data / Fragments

    * **ActionsPanel**: (í˜„ì¬) **Component ìŠ¤ì½”í”„** ì‹¤ë™ì‘ â€” ì´ë²¤íŠ¸ë³„ Step CRUD, Tag ì „í™˜/Tag Attrsë¥¼ SetProps ìŠ¤í…ìœ¼ë¡œ ì£¼ì…
    * **FlowsPanel**: from(node,event) â†’ to(Navigate/OpenFragment/CloseFragment) + when.expr êµ¬ì„±/í¸ì§‘
    * **DataPanel**: ì „ì—­ JSON í¸ì§‘/ì ìš©(`state.data`)
    * **FragmentsPanel**: í”„ë˜ê·¸ë¨¼íŠ¸ CRUD + **ì˜¤ë²„ë ˆì´ Open/Close**(OverlayHostë¡œ ë Œë”)
* **ìš°ì¸¡ ê³ ê¸‰ íŒ¨ë„**: `BottomRightHost` â€” **SchemaEditor** íƒ‘ì¬(ì»´í¬ë„ŒíŠ¸ propsSchema í”„ë¡œì íŠ¸ ì˜¤ë²„ë¼ì´ë“œ)
* **ë¦¬ì‚¬ì´ì €**: ìƒë‹¨(ë†’ì´), ì¤‘ì•™(ì¢Œ/ìš° í­) ëª¨ë‘ ë“œë˜ê·¸ ì§€ì›. ê°’ì€ `ui.bottomHeightPx`, `ui.bottomRight.widthPct` ë“±ì— ì €ì¥.

### 2.6 ê¸°ë³¸ ì»´í¬ë„ŒíŠ¸ â€” `editor/components/*` (+ `registerBasics.ts`)

* **Box**(div ê¸°ë³¸)
* **Text**(span ê¸°ë³¸, `{{}}` ë°”ì¸ë”© ì§€ì›)
* **Button**(button/a/div/span, href ì§€ì›, `__tag`/`__tagAttrs` ë°˜ì˜)
* **Image**(img void, ë¹ˆ src ë°©ì§€)

### 2.7 ì˜ì†í™” â€” `editor/bootstrap.ts` + `runtime/persistence.ts`

* **ë¡œì»¬ ìë™ ì €ì¥/ë³µì›**(debounce), UI/í”„ë¡œì íŠ¸ ëª¨ë‘ ì²˜ë¦¬.

---

## 3) í™•ì¸ëœ ê³µë°±/ì œì•½ ì‚¬í•­

* **onLoad ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±° ë¯¸êµ¬í˜„**: `SupportedEvent`ì—ëŠ” ì •ì˜ë˜ì–´ ìˆìœ¼ë‚˜ Canvasì—ì„œ mount ì‹œ ì‹¤í–‰ ë¡œì§ ë¶€ì¬.
* **DnD ë¯¸êµ¬í˜„**: íƒ€ì…ë§Œ ì¡´ì¬. Paletteâ†’Canvas ë“œë¡­, ë ˆì´ì–´ ì¬ì •ë ¬, ìº”ë²„ìŠ¤ ë‚´ before/after/inside ë“œë¡­ ë¯¸êµ¬í˜„.
* **Undo/Redo ì—†ìŒ**: í¸ì§‘ ì´ë ¥ ë° ë‹¨ì¶•í‚¤(Cmd/Ctrl+Z/Y) ë¶€ì¬.
* **ë©€í‹°ì…€ë ‰ì…˜/ê·¸ë£¹ ì‘ì—… ì—†ìŒ**: ë‹¤ì¤‘ ì„ íƒ, ì¼ê´„ props/styles ìˆ˜ì • ë¯¸ì§€ì›.
* **ë ˆì´ì–´ ëŒ€ìš©ëŸ‰ ëŒ€ë¹„ ìµœì í™” ì—†ìŒ**: ê°€ìƒ ìŠ¤í¬ë¡¤/ì ‘ê¸°/ì°¾ê¸° ë¯¸êµ¬í˜„.
* **A11y/ê²€ì‚¬ê¸° ì—†ìŒ**: alt ë¯¸ì§€ì •, ë²„íŠ¼ type ëˆ„ë½, ëŒ€ë¹„/ARIA ê²½ê³  ë“± í’ˆì§ˆ ì ê²€ ë„êµ¬ ë¶€ì¬.
* **HTTP ì•¡ì…˜ ê°œë°œì UX ë¶€ì¡±**: ëª¨í‚¹/ì‘ë‹µ ë§¤í•‘, ëŸ° ë¡œê·¸/ê²€ì¦ UI ì—†ìŒ.
* **TagPolicy í¸ì§‘ UI ì—†ìŒ**: í”„ë¡œì íŠ¸ ì°¨ì›ì˜ í—ˆìš© attribute/style ì •ì±…ì„ ì‹œê°ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ì—†ìŒ.
* **í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸°/ì¹´í…Œê³ ë¦¬/ë²„ì „ ì—†ìŒ**: ì¬ì‚¬ìš©ì„± ê°•í™”ë¥¼ ìœ„í•œ UXê°€ ê°„ì†Œ.
* **í˜‘ì—…/ì›ê²© ì €ì¥**: ë¡œì»¬ ì „ìš©. í”„ë¡œì íŠ¸ import/export(íŒŒì¼)ì™€ ì›ê²© API ì—°ë™ì´ ìŠ¤í….

> ì°¸ê³ : ì‚¬ìš©ì ê¸°ì–µ ë©”ëª¨ì— ìˆë˜ â€œdockRight(Layers docking) ìƒíƒœ ì˜ì†/ë¦¬ì‚¬ì´ì €â€ TODOëŠ” ë³¸ ì½”ë“œì—ì„  **ìš°ì¸¡ íŒ¨ë„ í­/ì¢Œì¸¡ ë¶„í• ** ì €ì¥ì€ ìˆìœ¼ë‚˜ **Layers ë„í‚¹ ìœ„ì¹˜ ì˜ì†**ì€ êµ¬ì¡°ìƒ ì•„ì§ ë¯¸í¬í•¨ì…ë‹ˆë‹¤.

---

## 4) ê³ ë„í™” ì œì•ˆ (ìš°ì„ ìˆœìœ„ ë¡œë“œë§µ)

### P0 â€” ì‚¬ìš©ì„±ì´ ë°”ë¡œ ì²´ê°ë˜ëŠ” ë¹ ë¥¸ ê°œì„ 

1. **onLoad ì´ë²¤íŠ¸ ì§€ì›**

    * Canvas.RenderNode mount ì‹œ 1íšŒ ì‹¤í–‰(ë…¸ë“œë³„ once). Flowë„ ë™ì¼ ê·œì•½.
    * ì•¡ì…˜ ì‹¤íŒ¨ ê²©ë¦¬ ìœ ì§€(try/catch), ëŸ° ë¡œê·¸ì— ê¸°ë¡.
2. **Undo/Redo(History)**

    * `store`ì— ring-buffer(`past`/`future` ë˜ëŠ” `history[] + ptr`) ì„¤ê³„, ë³€í™” ì§€ì ì€ store ì•¡ì…˜ ë‹¨ì¼ ì§„ì…ì ì—ì„œ ìŠ¤ëƒ…ìƒ·(diff) ê¸°ë¡.
    * ë‹¨ì¶•í‚¤, â€œë˜ëŒë¦¬ê¸°â€ ë²„íŠ¼ ì¶”ê°€.
3. **ë ˆì´ì–´ UX ë³´ê°•**

    * ì ‘ê¸°/í¼ì¹˜ê¸°, ê²€ìƒ‰, ëŒ€ìš©ëŸ‰ ê°€ìƒí™”(react-window) ë„ì….
4. **Actions ì‹¤í–‰ ë¡œê·¸ íŒ¨ë„(Logs)**

    * BottomRightì— `Logs` kind ì¶”ê°€. ì•¡ì…˜ ìŠ¤í…/HTTP ìš”ì²­/ì‘ë‹µ/ì—ëŸ¬ë¥¼ íƒ€ì„ë¼ì¸ìœ¼ë¡œ ì‹œê°í™”.

### P1 â€” ì œì‘/ì¡°ë¦½ ìƒì‚°ì„±

5. **DnD êµ¬í˜„**

    * Paletteâ†’Canvas insert, ë ˆì´ì–´ íŠ¸ë¦¬ reorder(before/after/inside). `store.update` ê¸°ë°˜ ì›ìì  ì´ë™.
6. **ë©€í‹°ì…€ë ‰ì…˜/ì¼ê´„ í¸ì§‘**

    * `ui.selectedIds: NodeId[]` í™•ì¥, Inspectorì—ì„œ ê³µí†µ í‚¤ë§Œ í¸ì§‘.
7. **TagPolicy í¸ì§‘ê¸°**

    * Tag â†’ allowedAttributes / styles.allow/deny í† ê¸€ UI. í…œí”Œë¦¿/í”„ë¡œì íŠ¸ ë ˆë²¨ merge ì •ì±… ëª…ì‹œ.
8. **í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸°/ì¹´í…Œê³ ë¦¬/ë²„ì „**

    * ì¸ë„¤ì¼(ìº”ë²„ìŠ¤ ë Œë” ìº¡ì²˜), íƒœê·¸/ì¹´í…Œê³ ë¦¬ í•„í„°, ë²„ì „ íˆìŠ¤í† ë¦¬ + ì¹˜í™˜ ì ìš©(diff ì•ˆë‚´).

### P2 â€” ì•± í’ˆì§ˆê³¼ í™•ì¥ì„±

9. **A11y & í’ˆì§ˆ ê²€ì‚¬ê¸°**

    * ë²„íŠ¼ type/alt ëˆ„ë½ ê²½ê³ , TabIndex, ì½˜íŠ¸ë¼ìŠ¤íŠ¸ ì²´í¬, ì¤‘ë³µ id íƒì§€.
10. **HTTP ì•¡ì…˜ ëª¨í‚¹ & ë°”ì¸ë”©**

    * ëª¨í‚¹ ìŠ¤ìœ„ì¹˜, ì‘ë‹µ â†’ `data.some.path` ìë™ ë§¤í•‘ UI, ì‹¤íŒ¨ ì¬ì‹œë„/ë°±ì˜¤í”„ ì˜µì…˜.
11. **ì›ê²© ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° + í”„ë¡œì íŠ¸ íŒŒì¼ I/O**

    * `persistence.ts` API êµ¬í˜„, JSON import/export, autosave ì¸ë””ì¼€ì´í„°.
12. **ì„±ëŠ¥/ì•ˆì •ì„±**

    * Canvas ëŒ€í˜• íŠ¸ë¦¬ì—ì„œ ë©”ëª¨ë¦¬ í”„ë¡œíŒŒì¼ë§, ë©”ëª¨ì´ì œì´ì…˜, batched updates.

---

## 5) ë°”ë¡œ ì ìš© ê°€ëŠ¥í•œ ì½”ë“œ ìŠ¤ë‹ˆí«

> *íŒŒì¼ ì „ì²´ê°€ ì•„ë‹ˆë¼ â€œì‚½ì… í¬ì¸íŠ¸â€ ì¤‘ì‹¬ì˜ ì•ˆì „ íŒ¨ì¹˜ì…ë‹ˆë‹¤. (ê·œì•½: any ê¸ˆì§€ / ì–•ì€ ë³µì‚¬ ìœ ì§€)*

### 5.1 Canvas: onLoad íŠ¸ë¦¬ê±° (ë…¸ë“œë³„ 1íšŒ)

```tsx
// Canvas.tsx ë‚´ë¶€
function RenderNode({ id, state }: { id: NodeId; state: EditorStoreState }) {
  const node = state.project.nodes[id] as Node;
  const renderer = getRenderer(node.componentId);
  const selected = state.ui.selectedId === id;

  // ğŸ”¹ onLoad 1íšŒ ì‹¤í–‰
  React.useEffect(() => {
    const bag = (node.props as Record<string, unknown>).__actions as
      | Record<string, { when?: { expr?: string }; steps?: ActionStep[] }>
      | undefined;
    const steps = (bag as any)?.onLoad?.steps ?? [];
    const whenExpr = (bag as any)?.onLoad?.when?.expr as string | undefined;
    if (!steps || steps.length === 0) return;
    if (whenExpr) {
      const ok = evalWhenExpr(whenExpr, { data: state.data, node, project: state.project });
      if (!ok) return;
    }
    void runActions(steps as ActionStep[], {
      alert: (msg) => alert(msg),
      setData: state.setData,
      setProps: state.updateNodeProps,
      navigate: (toPageId) => state.selectPage(toPageId),
      openFragment: (fid) => state.openFragment(fid),
      closeFragment: (fid) => state.closeFragment(fid),
      http: async (m, url, body, headers) => {
        const res = await fetch(url, { method: m, headers, body: body ? JSON.stringify(body) : undefined });
        return await res.json().catch(() => undefined);
      },
      emit: (_topic) => {},
    });
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  // ... (ê¸°ì¡´ ë Œë” ë¡œì§ ê·¸ëŒ€ë¡œ)
}
```

### 5.2 BottomRightHost: Logs íŒ¨ë„ íƒ€ì… ì¶”ê°€(ìŠ¤ìºí´ë“œ)

```ts
// core/types.ts
export type BottomRightPanelKind = 'SchemaEditor' | 'PropVisibility' | 'Logs' | 'None';
```

```tsx
// bottomPanel/BottomRightHost.tsx (switch ì¶”ê°€)
const title = ui.kind === 'SchemaEditor' ? 'Schema Editor'
  : ui.kind === 'Logs' ? 'Action Logs' : 'Advanced';
// ...
{ui.kind === 'SchemaEditor' && <SchemaEditor nodeId={nodeId} />}
{ui.kind === 'Logs' && <ActionLogs />} // TODO: ì‹ ê·œ ì»´í¬ë„ŒíŠ¸
```

### 5.3 store: History ìŠ¤ìºí´ë“œ(ì„¤ê³„ ê°€ì´ë“œ)

* `history: EditorState[]`, `cursor: number`ë¥¼ store ë°”ê¹¥ **ëª¨ë“ˆ ìŠ¤ì½”í”„**ì— ë‘ë©´ ìŠ¤ëƒ…ìƒ· ë©”ëª¨ë¦¬ ì••ë°•ì´ í¼ â†’
  **Patch ê¸°ë°˜**(ì‘ì€ delta) ë˜ëŠ” **í•µì‹¬ ì„œë¸ŒíŠ¸ë¦¬ë§Œ** ìŠ¤ëƒ…ìƒ· ê¶Œì¥.
* ì•ˆì „ì•ˆ: `update(fn)` ì§„ì…ì ì—ì„œ **ì´ì „/í˜„ì¬ì˜ `project`,`ui`ë§Œ** JSON ë¹„êµ(í•´ì‹œ)ë¡œ ë³€ê²½ ê°ì§€ í›„ push.
* ë‹¨ì¶•í‚¤ í•¸ë“¤ëŸ¬ëŠ” `ComponentEditor.tsx` ë£¨íŠ¸ì—ì„œ ë“±ë¡.

```ts
// store/editStore.ts (ê°œë… ì˜ˆì‹œ â€” ì‹¤ì œ êµ¬í˜„ ì‹œ íŒŒì¼ ì „ì²´ ë¦¬íŒ© ê¶Œì¥)
let history: Array<Pick<EditorState,'project'|'ui'>> = [];
let cursor = -1;

function pushHistory(s: EditorState) {
  const snap = { project: s.project, ui: s.ui };
  history = history.slice(0, cursor+1).concat(snap);
  cursor = history.length - 1;
}

// update ë‚´ë¶€ ë§ˆì§€ë§‰ì— ë³€ê²½ ê°ì§€ í›„ pushHistory(s)
```

---

## 6) í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ (ì²´í¬ë¦¬ìŠ¤íŠ¸)

* **ì‚½ì…/ì„ íƒ/ì‚­ì œ**: Paletteâ†’Box ì‚½ì…, ì„ íƒ í•˜ì´ë¼ì´íŠ¸, Layers ë°˜ì˜.
* **Styles/Props**: Typography(FontWeight/Size), Layout(Flex), Spacing(Padding) ì ìš©/ì €ì¥/ë³µì›.
* **Actions**: Button.onClick â†’ Alert/SetData/SetProps/Fragment Open/Close í™•ì¸, Logs ê¸°ë¡.
* **Flows**: node\:onClick â†’ Navigate/OpenFragment ì¡°ê±´ë¶€ when.expr ì ìš©.
* **Data ë°”ì¸ë”©**: Text.content = `Hello {{data.user}}` ë³€ê²½ ì¦‰ì‹œ ë°˜ì˜.
* **onLoad**: í˜ì´ì§€ ìµœì´ˆ ì§„ì… ì‹œ Node onLoad ì‹¤í–‰(once), ì¡°ê±´ì‹ true/false ê²€ì¦.
* **ì˜ì†í™”**: ìƒˆë¡œê³ ì¹¨ í›„ í”„ë¡œì íŠ¸/ì¢Œìš°í­/í•˜ë‹¨ ë†’ì´ ë³µì›.

---

## 7) ê²°ë¡ 

* ë³¸ ì½”ë“œë² ì´ìŠ¤ëŠ” **íƒ€ì… ì•ˆì •ì„±/ë ˆì´ì–´ ë¶„ë¦¬/SSOT íƒ€ì…/Shadow DOM** ë“± ê¸°ì´ˆ ì„¤ê³„ê°€ ê²¬ê³ í•©ë‹ˆë‹¤.
* ë‹¨ê¸°ê°„ì—ëŠ” **onLoad, Undo/Redo, Logs, Layers UX**ë¡œ ì‚¬ìš©ì„±ì„ ëŒì–´ì˜¬ë¦¬ê³ ,
* ì¤‘ê¸°ì ìœ¼ë¡œ **DnD/ë©€í‹°ì…€ë ‰ì…˜/TagPolicy í¸ì§‘/í…œí”Œë¦¿ UX**ë¥¼ ì¶”ê°€í•˜ë©´ Draftbit/Plasmic ë²”ì£¼ì˜ ì—ë””í„°ë¡œì„œ ê²½ìŸë ¥ì„ ê°–ì¶¥ë‹ˆë‹¤.
* ì¥ê¸°ì ìœ¼ë¡œ **ì›ê²© ì €ì¥Â·í˜‘ì—…Â·í’ˆì§ˆ ê²€ì‚¬ê¸°Â·ì„±ëŠ¥ ìµœì í™”**ë¥¼ ë„ì…í•´ í”„ë¡œë•ì…˜ ì›Œí¬í”Œë¡œìš°ë¥¼ ì§€ì›í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
